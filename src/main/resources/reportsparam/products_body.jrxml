<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
    name="products_body" pageWidth="535" pageHeight="200" columnWidth="535"
    leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0"
    whenNoDataType="AllSectionsNoDetail" uuid="9e2f1c3a-7b6d-4e5f-8a9b-0c1d2e3f4a5b">

    <!-- İstersen bu parametreyi tamamen kaldırabilirsin; kullanılmıyor -->
    <parameter name="P_QUERY" class="java.lang.String"/>

    <!-- NORMAL SORGUN -->
    <queryString language="SQL"><![CDATA[
        SELECT p.id,
               p.product_code,
               p.name,
               COALESCE(c.name,'') AS category,
               COALESCE(p.unit,'') AS unit,
               p.created_at
        FROM products p
        LEFT JOIN categories c ON c.id = p.category_id
        ORDER BY p.id DESC
    ]]></queryString>

    <!-- TEŞHİS AMAÇLI: Garanti 1 satır döndürmek için bunu kullanmak istersen,
         yukarıdaki queryString'i yorum satırına alıp bunu aç.
    <queryString language="SQL"><![CDATA[
        SELECT 1 AS id,
               'TEST' AS product_code,
               'Deneme' AS name,
               '' AS category,
               '' AS unit,
               NOW() AS created_at
    ]]></queryString>
    -->

    <field name="id" class="java.lang.Long"/>
    <field name="product_code" class="java.lang.String"/>
    <field name="name" class="java.lang.String"/>
    <field name="category" class="java.lang.String"/>
    <field name="unit" class="java.lang.String"/>
    <field name="created_at" class="java.sql.Timestamp"/>

    <!-- Subreport gerçekten render oluyor mu? -->
    <title>
        <band height="18">
            <staticText>
                <reportElement x="0" y="0" width="300" height="18" uuid="2b8e9c4a-9c5e-4c3a-8d3e-2f4a0a8b7c9d"/>
                <text><![CDATA[BODY RENDERED]]></text>
            </staticText>
        </band>
    </title>

    <detail>
        <band height="20">
            <textField>
                <reportElement x="0" y="0" width="40" height="20" uuid="2f6a7b8c-9d0e-4a1b-8c7d-6e5f4a3b2c1d"/>
                <textFieldExpression><![CDATA[$F{id}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="45" y="0" width="100" height="20" uuid="4c3b2a1f-0e9d-8c7b-6a5f-4e3d2c1b0a9f"/>
                <textFieldExpression><![CDATA[$F{product_code}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="150" y="0" width="160" height="20" uuid="5a6b7c8d-9e0f-1a2b-3c4d-5e6f7a8b9c0d"/>
                <textFieldExpression><![CDATA[$F{name}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="315" y="0" width="100" height="20" uuid="8d7c6b5a-4e3f-2a1b-0c9d-8e7f6a5b4c3d"/>
                <textFieldExpression><![CDATA[$F{category}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="420" y="0" width="60" height="20" uuid="3c2b1a0f-9e8d-7c6b-5a4f-3e2d1c0b9a8f"/>
                <textFieldExpression><![CDATA[$F{unit}]]></textFieldExpression>
            </textField>
        </band>
    </detail>

    <!-- Kaç satır geldiğini PDF sonunda göster -->
    <summary>
        <band height="18">
            <textField>
                <reportElement x="0" y="0" width="300" height="18" uuid="1c2d3e4f-5a6b-7c8d-9e0f-1a2b3c4d5e6f"/>
                <textFieldExpression><![CDATA["ROW COUNT = " + $V{REPORT_COUNT}]]></textFieldExpression>
            </textField>
        </band>
    </summary>
</jasperReport>
